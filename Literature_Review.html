<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Literature Review</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Literature_Review_files/libs/clipboard/clipboard.min.js"></script>
<script src="Literature_Review_files/libs/quarto-html/quarto.js"></script>
<script src="Literature_Review_files/libs/quarto-html/popper.min.js"></script>
<script src="Literature_Review_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Literature_Review_files/libs/quarto-html/anchor.min.js"></script>
<link href="Literature_Review_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Literature_Review_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Literature_Review_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Literature_Review_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Literature_Review_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Literature Review</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="updating-beliefs-based-on-observed-performance-evidence-from-nfl-head-coaches" class="level2">
<h2 class="anchored" data-anchor-id="updating-beliefs-based-on-observed-performance-evidence-from-nfl-head-coaches"><strong>Updating Beliefs Based on Observed Performance: Evidence From NFL Head Coaches</strong></h2>
<p><a href="https://journals.sagepub.com/doi/full/10.1177/15270025231222633" class="uri">https://journals.sagepub.com/doi/full/10.1177/15270025231222633</a></p>
<p>prior 4th down attempts influence future attempts</p>
<p>over react to failures rather then success (especially offensice coordinators).</p>
<p>more likely to succeed after prior failures</p>
<p>key quotes</p>
<p>. Of particular interest is whether managers are more sensitive to new positive or negative information and whether that sensitivity depends on their individual experiences as a manager.</p>
<p>We focus on two types of information: within-game information on prior fourth down successes and failures and information gathered over the season about overall success (yards per play) and situational success (success rate in short-yardage situations) for both the coach’s own team and the opposing team.</p>
<p>We find that coaches are sensitive to prior successful fourth down attempts and prior failed attempts within the game when making decisions to go for it on fourth down.</p>
<p>We have clear expectations about how coaches will rationally respond to changes in these factors (a coach should be more likely to attempt a fourth down conversion when their offense is shown to be stronger or the opposing team’s defense is shown to be weaker).</p>
<p>Romer (2006) demonstrates that coaches make suboptimal fourth down decisions if the goal is win-maximization.</p>
<p>The focus of this analysis is the subset of fourth down plays where a coach would conceivably consider running an offensive play. We base our primary definition of this on Romer (2006), which identifies downs and distances where the optimal decision is to run an offensive play on fourth down.</p>
<p>Conditional on attempting another fourth down, the success rate is unrelated to past successes within the game. Perhaps more surprisingly, success is positively and significantly related to prior in-game failures.</p>
<p>Coaches could make better decisions by putting less weight on past failures when they make decisions.</p>
</section>
<section id="revisiting-romer-digging-deeper-into-influences-on-nfl-managerial-decisions" class="level2">
<h2 class="anchored" data-anchor-id="revisiting-romer-digging-deeper-into-influences-on-nfl-managerial-decisions"><strong>Revisiting Romer: Digging Deeper Into Influences on NFL Managerial Decisions</strong></h2>
<p>Confirms Romer findings that coaches attempt 4th downs far to little</p>
<p>argued not coaches making poor decisions</p>
<p>it is rather due to risk aversion.</p>
<p>to avoid uncertainty coaches will give up expected points</p>
<p>there is a pattern of attempting 4th down when trailing/later in game/ have stronger offense.</p>
<p>more experienced coaches tend to be more conservative</p>
<p>key points</p>
<p>Generally, our results align very closely with Romer’s and appear to offer a clear and expanded confirmation that NFL managers are not simple maximizers of expected points.</p>
<p>Romer considers several alternative Goff and Locke 679 explanations. One is selection bias in the construction of the sample, noting that good teams are more likely to gain first downs near the opponent’s goal while poor teams are more likely to have first downs near their own goal.</p>
<p>However, our results raise doubts that this divergence from point maximization arises solely, or even mostly, from the lack of skill in processing the numbers. Instead, the assumption of risk neutrality is very questionable.</p>
</section>
<section id="what-was-lost-a-causal-estimate-of-fourth-down-behavior-in-the-national-football-league" class="level2">
<h2 class="anchored" data-anchor-id="what-was-lost-a-causal-estimate-of-fourth-down-behavior-in-the-national-football-league"><strong>What was lost? A causal estimate of fourth down behavior in the National Football League</strong></h2>
<p><a href="https://content.iospress.com/articles/journal-of-sports-analytics/jsa190294" class="uri">https://content.iospress.com/articles/journal-of-sports-analytics/jsa190294</a></p>
<p>clustered observations for situations and said did they go for it or just punt.</p>
<p>looked as situations where NYT bot said to go for it</p>
<p>Findings - shouldve been more aggressive</p>
<p>patriots, colts, and saints showed evidence of proper decision making.</p>
<p>Key Quotes</p>
<p>The primary goal of this manuscript is to estimate the potential benefit that teams have missed out</p>
<p>Plays are matched based on their yards to go for a first down, the play with the nearest predicted probability of going for it, closest in-game win probability, and most similar game time.</p>
<p>We used a 1:1 nearest neighbor matching algorithm with replacement via the Matching package in R</p>
<p>Filtering plays within the ‘go for it’ range of the 4th Down Bot</p>
<p>we retained 7,698 pairs of plays</p>
<p>First, the change in win probability for teams that did not go for it is centered at around-1%, with a relatively smaller variance</p>
</section>
<section id="quantifying-the-causal-effects-of-conservative-fourth-down-decision-making-in-the-national-football-league" class="level2">
<h2 class="anchored" data-anchor-id="quantifying-the-causal-effects-of-conservative-fourth-down-decision-making-in-the-national-football-league"><strong>Quantifying the Causal Effects of Conservative Fourth Down Decision Making in the National Football League</strong></h2>
<p>Yam, Derrick and Lopez, Michael and Lopez, Michael, Quantifying the Causal Effects of Conservative Fourth Down Decision Making in the National Football League (January 4, 2018). Available at SSRN:&nbsp;<a href="https://ssrn.com/abstract=3114242" class="uri">https://ssrn.com/abstract=3114242</a>&nbsp;or&nbsp;<a href="http://dx.doi.org/10.2139/ssrn.3114242" class="uri">http://dx.doi.org/10.2139/ssrn.3114242</a></p>
<p>same as the above paper</p>
</section>
<section id="momentum-and-organizational-risk-taking-evidence-from-the-national-football-league" class="level2">
<h2 class="anchored" data-anchor-id="momentum-and-organizational-risk-taking-evidence-from-the-national-football-league"><strong>Momentum and Organizational Risk Taking: Evidence from the National Football League</strong></h2>
<p><a href="https://pubsonline.informs.org/doi/10.1287/mnsc.1120.1574" class="uri">https://pubsonline.informs.org/doi/10.1287/mnsc.1120.1574</a></p>
<p>identify momentum across games and within games</p>
<p>when a organization is doing well they will take less risks.</p>
<p>negative momentum makes organizations less likely to take risk. when positive momentum will take more risk.</p>
<p>key notes</p>
<p>Dependent Variable. Risk taking. This was measured in terms of an offensive team’s choice of play on a fourth down. Risk taking was coded as a binary variable (0 for no risk taking, i.e., team punted or attempted a field goal on fourth down; 1 for risk taking, i.e., the team attempted a fourth down conversion by “going for it”).</p>
<p>Performance,</p>
<p>Within-period momentum. This was measured in terms of whether or not the offensive team was experiencing momentum in the game at hand, whether that momentum was positive (i.e., gains through scoring points against its opponent) or negative (i.e., losses through its opponent scoring points),</p>
<p>Across-period momentum. This was measured in terms of whether or not the offensive team was experiencing a series of wins or losses upon entering the game at hand and how many games had been won or lost consecutively.</p>
<p>In other words, given the same level of performance below the aspiration level, an organization was less likely to take risks if it had experienced negative momentum compared to positive momentum.</p>
<p>In other words, given the same level of performance above the aspiration level, an organization was more likely to take risks if it had experienced positive momentum compared to negative momentum.</p>
<p>Across-period momentum appears to only impact risky decisions early in a period before within-period feedback is available; within-period momentum impacts risky decisions after such feedback becomes available.</p>
</section>
<section id="moving-from-machine-learning-to-statistics-the-case-of-expected-points-in-american-football" class="level2">
<h2 class="anchored" data-anchor-id="moving-from-machine-learning-to-statistics-the-case-of-expected-points-in-american-football"><strong>Moving from Machine Learning to Statistics: the case of Expected Points in American football</strong></h2>
<p><a href="https://arxiv.org/abs/2409.04889" class="uri">https://arxiv.org/abs/2409.04889</a></p>
<p>Finds issue with current approach to calculating Expected Points</p>
<p>dont account for team quality</p>
<p>overfitting? -red flag with their justification of this- read this part more.</p>
<p>dont quantify uncertainty</p>
<p>plays in same drive are related</p>
<p>he has a few findings</p>
<p>Key quotes</p>
<p>They suffer from selection bias, display counter-intuitive artifacts of overfitting, do not quantify uncertainty in point estimates, and do not account for the strong dependence structure of observational football data.</p>
<p>We explore these issues in detail and devise expected points models that account for them.</p>
<p>. Analysts can evaluate an individual player by the value added across each of his plays. They can also evaluate a coach by how often he makes decisions that maximize the value of the next game-state.</p>
<p>The most prominent and widely used value function across all of sports analytics is expected points (EP).</p>
<p>Modern machine learning approaches, however, overlook several extremely important and quite thorny statistical issues. They don’t adjust for team quality, which produces EP estimates that are then misinterpreted as reflecting an average offense facing an average defense. These estimates apply not to an average offense but to a randomly drawn offense from the dataset of plays. Because good offenses run more plays and score more points, these estimates are size biased; they reflect an offense whose quality is a weighted average of offenses tilted towards good offenses. The same logic applies to defense. Selection biases of this sort appear in other estimation tasks across sports analytics. I</p>
<p>The strong dependence structure of the data, which significantly cuts down the number of independent observations, makes it even easier for machine learning tools to overfit. Analysts haven’t accounted for, let alone acknowledged, the dependency structure; they implicitly assume that the observational play-by-play football dataset consists entirely of independent plays. This is not true because all plays in an epoch share the same outcome. Ignoring the dependency structure potentially produces biased estimates and complicates the task of trying to do uncertainty quantification.</p>
<p>First, to mitigate selection 5bias, we adjust for team quality. Second, to reduce overfitting, we devise a novel method to regularize the fits of flexible, nonparametric models using synthetic data generated from simpler, parametric models. Third, we carefully examine the extent to which ignoring the dependency structure affects our ability to quantify uncertainty and we present several alternatives. In particular, we find that by bootstrapping an appropriately weighted XGBoost model, we can adequately quantify uncertainty.</p>
<p>-his point about overfitting does not make sense to me. there would be interactions that xgb is picking up on.</p>
<p>the point spread decreasing is shown on his graph to be associated with higher expected points.</p>
<p>BUT we arnt using regression we are not controlling rather we are predicting</p>
</section>
<section id="analytics-have-some-humility-a-statistical-view-of-fourth-down-decision-making" class="level2">
<h2 class="anchored" data-anchor-id="analytics-have-some-humility-a-statistical-view-of-fourth-down-decision-making"><strong>Analytics, have some humility: a statistical view of fourth-down decision making</strong></h2>
<p><a href="https://arxiv.org/abs/2311.03490" class="uri">https://arxiv.org/abs/2311.03490</a></p>
<p>Uncertainty is a un included factor?</p>
<p>only 30% of 4th down tries where confident 90% percent or more</p>
<p>says coaches only should be judged on this</p>
<p>??? see more about what type of bootsrapping he is talking about ???</p>
<p>key quotes</p>
<p>In this study, we argue it is imperative to knit uncertainty quantification into win probability-based decision making.</p>
<p>If we are not confident in a recommendation because it is subject to substantial uncertainty, we should not penalize a coach who doesn’t follow it.</p>
</section>
<section id="decision-making-on-the-hot-seat-and-the-short-list-evidence-from-college-football-fourth-down-decisions" class="level2">
<h2 class="anchored" data-anchor-id="decision-making-on-the-hot-seat-and-the-short-list-evidence-from-college-football-fourth-down-decisions"><strong>Decision-making on the hot seat and the short list: Evidence from college football fourth down decisions</strong></h2>
<p><a href="https://www.sciencedirect.com/science/article/pii/S0167268118300544?via%3Dihub" class="uri">https://www.sciencedirect.com/science/article/pii/S0167268118300544?via%3Dihub</a></p>
<p>coaches in the hot seat dont display behaviour that is optimal for maximizing wins</p>
<p>coaches that have good prospect for promotion become more aggressive and tend to attack a fourth down more.. this maximizes winning more</p>
<p>used a indices to predict likelihood of coach being fired…</p>
<p>matching situations where did/didnt go for it</p>
<p>key points</p>
<p>We examine the issue of how risky decisions can be affected by the state of one’s job prospects through an analysis of the labor market for NCAA head football coaches.</p>
<p>We find the opposite (a greater willingness to attempt a fourth down conversion) when their prospects for taking a new job improve (that is, when they are on the “short list” for a more attractive job).</p>
<p>First, we estimate parameters that proxy for a coach’s pre-season beliefs about being fired and being promoted to a more attractive job. Then we investigate whether job status influences the risky decision to attempt a fourth down conversion. Our findings suggest that, intentionally or not, coaches do factor their career status into fourth down decisions.</p>
</section>
<section id="running-to-the-top-investigating-running-back-archetypes-and-player-trajectories" class="level2">
<h2 class="anchored" data-anchor-id="running-to-the-top-investigating-running-back-archetypes-and-player-trajectories"><strong>Running to the Top: Investigating Running Back Archetypes and Player Trajectories</strong></h2>
<p><a href="https://harvardsportsanalysis.org/2024/06/running-to-the-top-investigating-running-back-archetypes-and-player-trajectories/" class="uri">https://harvardsportsanalysis.org/2024/06/running-to-the-top-investigating-running-back-archetypes-and-player-trajectories/</a></p>
<p>5 clusters of Rbs</p>
</section>
<section id="on-the-existence-of-momentum-in-professional-football" class="level2">
<h2 class="anchored" data-anchor-id="on-the-existence-of-momentum-in-professional-football"><strong>On the existence of momentum in professional football</strong></h2>
<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0269604" class="uri">https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0269604</a></p>
<p>define momentum as sustained increase in win prob over at least 2 changes of possession</p>
<p>There are streaks of increasing win probability</p>
<p>long streaks of momentum are not random</p>
<p>the team that won tends to have had more momentum/streaks</p>
<p>key quotes</p>
<p>A physiological basis for the existence of momentum can be argued in connection with the so-called “winner effect,” in which a win (variously defined) increases the odds of subsequent winning.</p>
<p>Here, we will construct and propose a precise definition of momentum in the context of professional football: the sustained increase in win probability by a single team over the course of at least 2 successive changes in possession (i.e., on offense and then on defense, or alternatively on defense and then on offense).</p>
<p>Perhaps of equal importance to the result that win probability streaks in football are non-random</p>
<p>Given that momentum, as defined in this paper, exists and that there is some means of anticipating its development</p>
<p>As discussed previously, (home team) momentum is most likely to develop when the score is relatively close and there is time on the clock.</p>
</section>
<section id="false-start-an-analysis-of-nfl-penalties-with-and-without-crowds" class="level2">
<h2 class="anchored" data-anchor-id="false-start-an-analysis-of-nfl-penalties-with-and-without-crowds"><strong>False Start? An Analysis of NFL Penalties With and Without Crowds</strong></h2>
<p><a href="https://journals.sagepub.com/doi/full/10.1177/15270025221148997" class="uri">https://journals.sagepub.com/doi/full/10.1177/15270025221148997</a></p>
<p>crowds had not significant effect for offensive pre snap penalties</p>
<p>they did however have a effect where home defenses wher positivly effected.</p>
<p>false starts happen more on 3rd and 4th down.</p>
<p>more likely closer to own end zone</p>
<p>key quotes</p>
<p>There is some evidence to support this claim.While pre-snap offensive penalties (false starts) were not affected by crowds, pre-snap defensive penalties called against he home team are lower with the presence of spectators (alternatively they are higher in games with no crowds)</p>
<p>If NFL teams want to learn anything from this, it is that encouraging crowd noise is somewhat effective.</p>
</section>
<section id="behavioral-biases-in-daily-fantasy-baseball-the-case-of-the-hot-hand" class="level2">
<h2 class="anchored" data-anchor-id="behavioral-biases-in-daily-fantasy-baseball-the-case-of-the-hot-hand"><strong>Behavioral Biases in Daily Fantasy Baseball: The Case of the Hot Hand</strong></h2>
<p><a href="https://journals.sagepub.com/doi/full/10.1177/15270025221128955" class="uri">https://journals.sagepub.com/doi/full/10.1177/15270025221128955</a></p>
<p>baseball - found no evidence that hot hand players exist. some evidence that it may actually not exist</p>
<p>bias towards “hot” players</p>
<p>overvalue recent performances</p>
<p>key quotes</p>
<p>Despite mixed evidence, sport participants and fans heavily believe in the existence of the hot hand. Prior literature examining NBA and NFL betting markets found betters were biased towards hot teams.</p>
<p>In professional darts tournaments, Stins et al.&nbsp;(2018) find evidence that performance in the second throw of a three-throw leg was not independent of the first throw.</p>
<p>This study adds to the hot hand literature in two critical ways. First, it considers hot hand with a unique baseball data set. Second, it borrows from prior literature focusing on the hot hand in sport betting to examine a new marketplace: daily fantasy sports.</p>
<p>Ultimately, we fail to identify a viable hot hand strategy in DraftKings DFS baseball, but acknowledge that our sample may not be sizeable enough to identify an effect, given the immense amount of noisiness in game and player outcomes.</p>
</section>
<section id="nfl-data-analytics-for-a-new-era" class="level2">
<h2 class="anchored" data-anchor-id="nfl-data-analytics-for-a-new-era"><strong>NFL Data Analytics For A New Era</strong></h2>
<p>chrome-<a href="extension://efaidnbmnnnibpcajpcglclefindmkaj/https://support.sas.com/resources/papers/proceedings17/2023-2017.pdf">extension://efaidnbmnnnibpcajpcglclefindmkaj/https://support.sas.com/resources/papers/proceedings17/2023-2017.pdf</a></p>
<p>coaches are generally two conservative</p>
<p>60-70 percent of the time they make optimal decisions.</p>
<p>key quotes</p>
<p>Our goal for this analysis is to create a predictive model that will output a percentage for a team to win for any given game.</p>
<p>To start our predictive model we created more advanced and in depth statistics that we thought would have a high correlation with whether the team won a given game. After parsing the description for each play and extracting the information, we created 191 other variables.</p>
<p>We ran a stepwise logistic regression with all of our 153 plausible variables testing for a significance at a level of 5 percent. We ended with a formula that had 9 significant variables, predicted the correct outcome of the game 64 percent of the time, and had an R-squared of 12.4 percent.</p>
<p>When punting or kicking a field goal is the recommended fourth down decision, coaches correctly make the decision around 80% of the time. However, when the recommended decision is to go for it, coaches only make the decision to go for it 20% of the time.</p>
</section>
<section id="the-price-of-playing-through-pain-the-link-between-physical-and-behavioral-health-in-former-nfl-athletes" class="level2">
<h2 class="anchored" data-anchor-id="the-price-of-playing-through-pain-the-link-between-physical-and-behavioral-health-in-former-nfl-athletes"><strong>The Price of Playing Through Pain: The Link Between Physical and Behavioral Health in Former NFL Athletes</strong></h2>
<p><a href="https://journals.sagepub.com/doi/full/10.1177/1557988320975541" class="uri">https://journals.sagepub.com/doi/full/10.1177/1557988320975541</a></p>
<p>telephone survey</p>
<p>each type of pains relationship with anger attacks</p>
<p>each one increases likelihood.</p>
<p>longer careers associated with decreased odds of anger attaks</p>
</section>
<section id="no-access-via-smu" class="level2">
<h2 class="anchored" data-anchor-id="no-access-via-smu">No access via SMU</h2>
<p>Lopez, M. J. (2020). Bigger data, better questions, and a return to fourth down behavior: An introduction on tracking data in the national football league. Journal of Quantitative Analysis in Sports, 16(2), 73–79. https://doi.org/10.1515/jqas-2020-0057</p>
<p>Momentum <a href="https://www.degruyter.com/document/doi/10.1515/1559-0410.1362/html" class="uri">https://www.degruyter.com/document/doi/10.1515/1559-0410.1362/html</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>